---
title: "Box Plots and Line Plots"
author: "Joel Parker"
date: "2023-07-17"
output: html_document
---

```{r setup, include=FALSE}
# Set global chunk obptions
knitr::opts_chunk$set(fig.width=12, fig.height=12)

# Data 
library(tidyverse)
library(openxlsx)
library(kableExtra)
library(table1)
library(flextable)
library(reshape2)


# Heat Map
library(pheatmap)
library(RColorBrewer)
library(rstatix)
library(plotly)

# PCA
library(factoextra)
library(FactoMineR)


## Combining plots
library(ggpubr)


## Image package
library(magick)

## Pairwise comparisons
library(emmeans)

# Metabolomics Pipeline source files
files.sources = list.files("../R")
sapply(paste0("../R/",files.sources), source)

```

## Box Plots and Line Plots
Visualizations of the data can help us see the underlying trends. Two useful visualization
is boxplots and line graphs. Metabolon provides customers with similar box plots,
but the following will allow to look at the boxplots specifically with a sub-pathway. 


### Boxplots

Suppose there is a specific subpathway that we would like to visualize. In that 
case, we can compare the treatment groups for each metabolite within that 
sub-pathway using the subpathway_box plots function defined in the R script. T
his function takes the following arguments.

* Analysis data (analysis_data): This is the analysis data used for the modeling
in the primary analysis. If you followed this pipeline all the way through, the 
analysis data is saved in the Data/Processed folder. 

* Chemical annotation data (chem_data): The chemical annotation data. This argument
is necessary to link the columns of the analysis data to the sub
pathways. If you followed this pipeline all the way through, the analysis data is
saved in the Data/Processed folder. 

* Pathway (pathway): This is the name of the sub-pathway of interest. 

* X: This the the name of the variable in the meta data that is used for the 
X axis of the box plots. 

* Group By (groupBy): This is a grouping variable. As a recommendation the treatment
groups should be used in the groupBy argument as this will provide a different color
for each of the treatments making it easier to identify. 

* ... : At the end of this function you can provide additional arguments for filtering
the analysis data. In the examples below we are filtering so the box plots only 
focus on males and only two treatment groups. 

The output of the subpathway_boxplot function is box plots for each of the 
metabolites within the specified subpathway. The labels for the box plots are 
default based on the data created inside the subpathway_boxplots function. Since
these box plots utilize ggplot, we can customize all labels using the. [labs](https://ggplot2.tidyverse.org/reference/labs.html) function
from ggplot. 

#### Box plots example
Here we look at the boxplots for each metabolite within a specified subpathway utilizing
the subpathway_boxplots function. The subpathway_boxplots function takes the 
following arguments


```{r boxplots, fig.width = 10, fig.height=10}

# 1. Read in analysis data
analysis_data <- read.csv("../Data/Processed/analysis_data.csv", check.names = F)

# 2. Reach in chemical annotation data
# Read chemical annotation file
met_excel <- "../Data/Metabolon/UNAZ-0501-22VW_ DATA TABLES.xlsx"
chem_data <- read.xlsx(met_excel,sheet = "Chemical Annotation")
  
# 3. Specify subpathway of interest. 
subpath = "Gamma-glutamyl Amino Acid"


# 4. Run the subpathway_boxplots function
box_1 <- subpathway_boxplots(analysis_data =  analysis_data,
                chem_data = chem_data,
                subpathway = subpath,
                X = TIME1,
                groupBy = GROUP_NAME,
                # Additional analysis data filtering options. 
                Gender == "Male", GROUP_NAME != "Control")


# 5. Customize labels for the boxplots
box_1 +
  labs(x = "Time", y="Scaled Intensity", color="Treatment Group",
       title = "Metabolite boxplots for the Gamma-glutamyl Amino Acid Subpathway")


# 6. Save boxplots. You can change the file type for example change pdf to png. 
ggsave(filename = paste0("../Outputs/Plots/Metabolite_boxplots_",subpath,".pdf"))

```


