\nonstopmode{}
\documentclass[a4paper]{book}
\usepackage[times,inconsolata,hyper]{Rd}
\usepackage{makeidx}
\makeatletter\@ifl@t@r\fmtversion{2018/04/01}{}{\usepackage[utf8]{inputenc}}\makeatother
% \usepackage{graphicx} % @USE GRAPHICX@
\makeindex{}
\begin{document}
\chapter*{}
\begin{center}
{\textbf{\huge Package `MetabolomicsPipeline'}}
\par\bigskip{\large \today}
\end{center}
\ifthenelse{\boolean{Rd@use@hyper}}{\hypersetup{pdftitle = {MetabolomicsPipeline: Metabolomics Pipeline Tools}}}{}
\ifthenelse{\boolean{Rd@use@hyper}}{\hypersetup{pdfauthor = {Joel Parker}}}{}
\begin{description}
\raggedright{}
\item[Title]\AsIs{Metabolomics Pipeline Tools}
\item[Version]\AsIs{0.0.1}
\item[Description]\AsIs{This package was developed to provide analysis tools and a workflow for analyzing metabolomics data produced by Metabolon.}
\item[biocViews]\AsIs{Metabolomics}
\item[License]\AsIs{MIT + file LICENSE}
\item[Encoding]\AsIs{UTF-8}
\item[Roxygen]\AsIs{list(markdown = TRUE)}
\item[RoxygenNote]\AsIs{7.3.1}
\item[Suggests]\AsIs{ggplotify, magick, openxlsx, rmarkdown, table1, testthat (>=
3.0.0)}
\item[Config/testthat/edition]\AsIs{3}
\item[Imports]\AsIs{dplyr (>= 1.1.3), emmeans (>= 1.8.8), factoextra (>= 1.0.7),
FactoMineR (>= 2.8), ggplot2 (>= 3.4.3), grDevices (>= 3.6.0),
kableExtra (>= 1.3.4), knitr (>= 1.44), methods (>= 4.3.1),
pheatmap (>= 1.0.12), plotly (>= 4.10.2), RColorBrewer (>=
1.1.3), readxl, reshape2 (>= 1.4.4), stringr (>= 1.5.0),
SummarizedExperiment, tibble, tidyr (>= 1.3.0)}
\item[Depends]\AsIs{R (>= 4.3)}
\item[LazyData]\AsIs{true}
\item[VignetteBuilder]\AsIs{knitr}
\item[Author]\AsIs{Joel Parker [aut, cre]}
\item[Maintainer]\AsIs{Joel Parker }\email{joelparker@arizona.edu}\AsIs{}
\end{description}
\Rdcontents{Contents}
\HeaderA{all\_sig\_subpath}{Table of Significant Subpathways}{all.Rul.sig.Rul.subpath}
%
\begin{Description}
Create a table of all significant subpathways
\end{Description}
%
\begin{Usage}
\begin{verbatim}
all_sig_subpath(path_results)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{path\_results}] Results data frame generated by \code{\LinkA{subpathway\_analysis}{subpathway.Rul.analysis}}
\end{ldescription}
\end{Arguments}
%
\begin{Value}
A table of all significant subpathways. Including the significant model type
and model type p-value.
\end{Value}
\HeaderA{create\_heatmap\_Data}{Create metadata and matricies for metabolite heatmaps}{create.Rul.heatmap.Rul.Data}
%
\begin{Description}
This function creates the required matrices for the metabolite heatmaps.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
create_heatmap_Data(data, heatmap_variables, assay = "normalized", ...)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{data}] A SummarizedExperiment containing Metabolon data.

\item[\code{heatmap\_variables}] A vector of variable names that are NOT metabolites.

\item[\code{assay}] Name of assay data to be used for heatmaps. Default="normalized".

\item[\code{...}] Additional arguments that can be passed into the arrange function.
This parameter will order the columns of the heatmap data.
\end{ldescription}
\end{Arguments}
%
\begin{Value}
A list of matrices including the heatmap variable (meta data for heatmap)
and the values for the heatmap.
\end{Value}
\HeaderA{loadMetabolon}{Load Metabolomic Data as SummarizedExperiment}{loadMetabolon}
%
\begin{Description}
Automatically load metabolomic data from Metabolon
\end{Description}
%
\begin{Usage}
\begin{verbatim}
loadMetabolon(
  path,
  raw_sheet = "Peak Area Data",
  chemical_sheet = "Chemical Annotation",
  sample_meta = "Sample Meta Data",
  normalized_peak = "Log Transformed Data",
  sample_names = "PARENT_SAMPLE_NAME",
  chemicalID = "CHEM_ID"
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{path}] Path to Metabolon .xlsx file containg peak data, chemical annotations,
sample meta data, and (optionally) the normalized peak counts

\item[\code{raw\_sheet}] Sheet name for the raw peak data.

\item[\code{chemical\_sheet}] Sheet name for chemical annotation.

\item[\code{sample\_meta}] Sheet name for sample meta data.

\item[\code{normalized\_peak}] Sheet name for the normalized peak data. If you are not
adding the normalized data from the excel file then set normalized\_peak=NA.

\item[\code{sample\_names}] Column name in the meta data containing the sample names. This must correspond to
the row names of the raw peak data in the excel file.

\item[\code{chemicalID}] Column name in the meta data containing the sample names. This must correspond to
the column names of the raw peak data.
\end{ldescription}
\end{Arguments}
%
\begin{Details}
The Metabolon experiment data are stored in a SummarizedExperiment.
\end{Details}
%
\begin{Value}
A SummarizedExperiment containing Metabolon expirement data.
\end{Value}
%
\begin{SeeAlso}
\LinkA{SummarizedExperiment::SummarizedExperiment}{SummarizedExperiment::SummarizedExperiment}
\end{SeeAlso}
\HeaderA{log\_transformation}{Log transformation of metabolite data}{log.Rul.transformation}
%
\begin{Description}
This function log transforms each metabolite in the Metabolon data.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
log_transformation(peak_data)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{peak\_data}] A matrix of peak data with metabolites in the columns
\end{ldescription}
\end{Arguments}
%
\begin{Value}
log transformed peak data
\end{Value}
\HeaderA{median\_standardization}{Median standardization for metabolite data}{median.Rul.standardization}
%
\begin{Description}
This function standardizes the metabolites by the median of the metabolite.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
median_standardization(peak_data)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{peak\_data}] Peak data with metabolites in the columns. The data also
must include the "PARENT\_SAMPLE\_NAME".
\end{ldescription}
\end{Arguments}
%
\begin{Value}
Median standardized peak data.
\end{Value}
\HeaderA{metabolite\_heatmap}{Create metabolite heatmap}{metabolite.Rul.heatmap}
%
\begin{Description}
Create heatmaps which are arranged by the experimental conditions.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
metabolite_heatmap(
  data,
  top_mets = 50,
  group_vars,
  strat_var = NULL,
  caption = NULL,
  Assay = "normalized",
  ...
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{data}] A SummarizedExperiment containing the Metabolon experiment data.

\item[\code{top\_mets}] Number of metabolites to include in the heatmap. Metabolites
are chosen based on the highest variability.

\item[\code{group\_vars}] Vector of variables to annotate heatmap with. Columns will
be grouped by these variables.

\item[\code{strat\_var}] Variable to stratify the heatmap by.

\item[\code{caption}] A title for the heatmap. If strat\_var is used, the title will
automatically include the stratum with the tile.

\item[\code{Assay}] Which assay data to use for the heatmap (default="normalized").

\item[\code{...}] Additional arguments can be passed into the arrange function.
This parameter will order the columns of the heatmap.
\end{ldescription}
\end{Arguments}
%
\begin{Value}
A gtable class with all of the information to build the heatmap. To view
the heatmap use ggplotify::as.ggplot().
\end{Value}
\HeaderA{metabolite\_pairwise}{Metabolite Pairwise Comparisons.}{metabolite.Rul.pairwise}
%
\begin{Description}
Computes the pairwise comparison estimates and p-values for each metabolite.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
metabolite_pairwise(
  data,
  form,
  Assay = "normalized",
  strat_var = NULL,
  mets = NULL
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{Assay}] Name of the assay to be used for the pairwise analysis (default='normalized')

\item[\code{mets}] Chemical ID for the metabolites of interest. If NULL then the pairwise analysis
is completed for all metabololites.

\item[\code{form:}] This is a character string the resembles the right hand side of a
simple linear regression model in R. For example form = "Group1 + Group2".

\item[\code{data:}] SummarizedExperiment with Metabolon experiment data.

\item[\code{strat\_var:}] A variable in the analysis data to stratify the model by. If this
is specified, a list of results will be returned.
\end{ldescription}
\end{Arguments}
%
\begin{Details}
This function will analyze each metabolite individually. For each metabolite, the metabolite\_pairwise function
will first test whether the model explained a significant proportion
of the variance in the metabolite using an F-test. Since we will be looking at
multiple comparisons for the metabolite, it is good practice to first look at the
overall p-value from the F-test before looking at the pairwise comparisons.
The metabolite\_pairwise function then looks at all pairwise comparisons utilizing
the \Rhref{https://cran.r-project.org/web/packages/emmeans/index.html}{emmeans} package.
The metabolite\_pairwise function returns a data frame with the metabolite overall
p-value, log fold change for each group, and the p-value
for each comparison.
\end{Details}
%
\begin{Value}
The overall F-test p-value, and the estimate and pvalue for each pairwise comparison.
\end{Value}
\HeaderA{metabolite\_pca}{Metabolite PCA}{metabolite.Rul.pca}
%
\begin{Description}
Computes and plots the first two components of the PCA from the metabolite data.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
metabolite_pca(data, Assay = "normalized", meta_var)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{data}] SummarizedExperiment with Metabolon experiment data.

\item[\code{Assay}] Name of the assay to be used for the pairwise analysis (default='normalized')

\item[\code{meta\_var}] A metadata variable to color code the PCA plot by.
\end{ldescription}
\end{Arguments}
%
\begin{Value}
A PCA plot of the first two principal components, colored by the metadata
variable.
\end{Value}
\HeaderA{met\_est\_heatmap}{Metabolite Pairwise Estimate Interactive Heatmap.}{met.Rul.est.Rul.heatmap}
%
\begin{Description}
Produce an interactive heatmap of the estimates produced in \code{\LinkA{metabolite\_pairwise}{metabolite.Rul.pairwise}}.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
met_est_heatmap(results_data, data)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{results\_data}] Results data frame of the pairwise comparisons produced by \code{\LinkA{metabolite\_pairwise}{metabolite.Rul.pairwise}}.

\item[\code{data}] A SummarizedExperiment containing the Metabolon experiment data.
\end{ldescription}
\end{Arguments}
%
\begin{Details}
This function will produce a heatmap of the log fold changes for the metabolites
with a significant overall p-value (which tested if the treatment group means
were equal under the null hypothesis). The heatmap colors will only show if
the log fold-change is greater than log(2) or less than log(.5). Therefore,
this heatmap will only focus on comparisons with a fold change of two or greater.
\end{Details}
%
\begin{Value}
An interactive heatmap of pairwise estimates.
\end{Value}
\HeaderA{met\_p\_heatmap}{Metabolite Pairwise P-Value Interactive Heatmap.}{met.Rul.p.Rul.heatmap}
%
\begin{Description}
Produce an interactive heatmap of the p-values produced in \code{\LinkA{metabolite\_pairwise}{metabolite.Rul.pairwise}}.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
met_p_heatmap(results_data, data)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{results\_data}] Results data frame of the pairwise comparisons produced by \code{\LinkA{metabolite\_pairwise}{metabolite.Rul.pairwise}}.

\item[\code{data}] A SummarizedExperiment containing Metabolon experiment data.
\end{ldescription}
\end{Arguments}
%
\begin{Details}
For the metabolites which had a significant overall p-value (which tested if the
treatment group means were equal under the null hypothesis), we will produce a
heatmap of the p-values.
\end{Details}
%
\begin{Value}
An interactive heatmap of pairwise p-values.
\end{Value}
\HeaderA{met\_within\_sub}{Metabolites within Subpathway Table}{met.Rul.within.Rul.sub}
%
\begin{Description}
Return the model results for each metabolite within a subpathway.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
met_within_sub(
  subpath_results,
  subpathway,
  mod = c("interaction", "parallel", "single")
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{subpath\_results}] Results data frame generated by \code{\LinkA{subpathway\_analysis}{subpathway.Rul.analysis}}

\item[\code{subpathway}] Character string of the subpathway of interest. This is case sensitive
and must be listed in the subpath\_results.

\item[\code{mod}] Model of interest. This can be a single model or a vector of model types
that can take on the values "interaction", "parallel", or "single".
\end{ldescription}
\end{Arguments}
%
\begin{Value}
A table with the results from the model types specified and for each
metabolite within the superpathway specified.
\end{Value}
\HeaderA{min\_val\_impute}{Minimum Value Imputation}{min.Rul.val.Rul.impute}
%
\begin{Description}
Imputes the minimum value for each metabolite
\end{Description}
%
\begin{Usage}
\begin{verbatim}
min_val_impute(peak_data)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{peak\_data}] Peak data matrix with metabolites in the columns.
\end{ldescription}
\end{Arguments}
%
\begin{Value}
Metabolite imputed peak data.
\end{Value}
\HeaderA{pairwise}{Pairwise function}{pairwise}
%
\begin{Description}
This is the main function for metabolite\_pairwise
\end{Description}
%
\begin{Usage}
\begin{verbatim}
pairwise(out, form, data)
\end{verbatim}
\end{Usage}
\HeaderA{subpathway\_analysis}{Subpathway Analysis}{subpathway.Rul.analysis}
%
\begin{Description}
Subpathway analysis for metabolite data.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
subpathway_analysis(
  data,
  treat_var,
  block_var = NULL,
  strat_var = NULL,
  Assay = "normalized",
  subPathwayName = "SUB_PATHWAY",
  chemName = "CHEMICAL_NAME",
  superPathwayName = "SUPER_PATHWAY"
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{data}] SummarizedExperiment with Metabolon experiment data.

\item[\code{treat\_var}] This is the name of the variable in the analysis data that is the main variable of interest.

\item[\code{block\_var}] This is the name of the blocking variable in the dataset.
If the the experimental design does not include a blocking variable, then the
value of block\_var=NULL.

\item[\code{strat\_var}] Variable to stratify the subpathway analysis by. This is set
to NULL by default and will not stratify the analysis unless specified.

\item[\code{Assay}] Name of the assay to be used for the pairwise analysis (default='normalized')

\item[\code{subPathwayName}] Column name for subpathway variable as defined in the chemical annotation worksheet.

\item[\code{chemName}] Column name for chemical name variable as defined in the chemical annotation worksheet.

\item[\code{superPathwayName}] Column name for super-pathway variable as defined in the chemical annotation worksheet.
\end{ldescription}
\end{Arguments}
%
\begin{Details}
For each metabolite, we test three models using using ANOVA.
\begin{itemize}


\item{} Interaction: \eqn{log Peak = Treatment + block + Treatment*block}{}

\item{} Parallel:  \eqn{log Peak = Treatment + block}{}

\item{} Single:  \eqn{log Peak =  Treatment}{}


\end{itemize}


For the interaction model, we are focusing only on the interaction term
"Treatment*block" to test if there is a significant interaction between our
treatment and the block variable. The parallel model tests if the block variable
explains a significant amount of the metabolite variance, and the treatment model
tests if the treatment explains a significant proportion of the variance for
each metabolite. Then, we use the Combined Fisher probability to test each model
at the subpathway level.

\deqn{\tilde{X} = -2\sum_{i=1}^k ln(p_i)}{}
\end{Details}
%
\begin{Value}
A data frame with "CHEM\_ID","sub\_pathway","chem\_name","interaction\_pval","interaction\_fisher","parallel\_pval","parallel\_fisher","single\_pval","single\_fisher",and "model" for each metabolite.
\end{Value}
%
\begin{SeeAlso}
\Rhref{https://www.sciencedirect.com/science/article/pii/S0167947303002950}{Loughin, Thomas M. "A systematic comparison of methods for combining p-values from independent tests." Computational statistics \& data analysis 47.3 (2004): 467-485.}
\end{SeeAlso}
\HeaderA{subpathway\_boxplots}{Subpathway Boxplots}{subpathway.Rul.boxplots}
%
\begin{Description}
Creates boxplots for each metabolite within a specified subpathway.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
subpathway_boxplots(
  data,
  subpathway,
  block_var,
  treat_var,
  Assay = "normalized",
  ...
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{data}] SummarizedExperiment with Metabolon experiment data.

\item[\code{subpathway}] Character value of the subpathway of interest. This is case
sensitive and must be in the chemical annotation file.

\item[\code{block\_var}] This the the name of the variable in the meta data that is used for the
X axis of the box plots. We recommend using the "block\_var" from the subpathway
analysis.

\item[\code{treat\_var}] This is a grouping variable. As a recommendation the treatment
groups should be used in the treat\_var argument as this will provide a different color
for each of the treatments making it easier to identify.

\item[\code{Assay}] Name of the assay to be used for the pairwise analysis (default='normalized')

\item[\code{...}] Additional arguments to filter the analysis data by.
\end{ldescription}
\end{Arguments}
%
\begin{Details}
.
\end{Details}
%
\begin{Value}
Boxplots stratified by metabolites.
\end{Value}
\HeaderA{subpathway\_lineplots}{Subpathway Lineplots}{subpathway.Rul.lineplots}
%
\begin{Description}
Create line plots for each metabolite within a subpathway.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
subpathway_lineplots(
  data,
  subpathway,
  block_var,
  treat_var,
  Assay = "normalized",
  ...
)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{data}] SummarizedExperiment with Metabolon experiment data.

\item[\code{subpathway}] Character value of the subpathway of interest. This is case
sensitive and must be in the chemical annotation file.

\item[\code{block\_var}] This the the name of the variable in the meta data that is used for the
X axis of the line plots. We recommend using the "block\_var" variable from the
subpathway analyis.

\item[\code{treat\_var}] This is a grouping variable. As a recommendation the treatment
groups should be used in the groupBy argument as this will provide a different color
for each of the treatments making it easier to identify.

\item[\code{Assay}] Name of the assay to be used for the pairwise analysis (default='normalized')

\item[\code{...}] Additional arguments to filter the analysis data by.
\end{ldescription}
\end{Arguments}
%
\begin{Value}
Line plots stratified by metabolite.
\end{Value}
\HeaderA{subpath\_by\_model}{Subpathway model type table}{subpath.Rul.by.Rul.model}
%
\begin{Description}
Create a table with the number of significant subpathways for each model type.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
subpath_by_model(subpath_results)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{subpath\_results}] Results data frame generated by \code{\LinkA{subpathway\_analysis}{subpathway.Rul.analysis}}
\end{ldescription}
\end{Arguments}
%
\begin{Details}
Each subpathway will only have one model type. We first test the interaction,
and then the parallel and single models are tested last. Suppose a subpathway
has a significant interaction model type. In that case, the table will count
it as an interaction and not as a parallel or single.
\end{Details}
%
\begin{Value}
A table of the number of significant subpathways by model type.
\end{Value}
\HeaderA{subpath\_within\_superpath}{Proportion of the Significant Subpathways Within Superpathways}{subpath.Rul.within.Rul.superpath}
%
\begin{Description}
Create a table that gives the percentage of significant subpathways within each
superpathway.
\end{Description}
%
\begin{Usage}
\begin{verbatim}
subpath_within_superpath(subpath_results)
\end{verbatim}
\end{Usage}
%
\begin{Arguments}
\begin{ldescription}
\item[\code{subpath\_results}] Results data frame generated by \code{\LinkA{subpathway\_analysis}{subpathway.Rul.analysis}}
\end{ldescription}
\end{Arguments}
%
\begin{Value}
A table with the proportion (and percent) of significant subpathways within superpathways.
\end{Value}
\printindex{}
\end{document}
