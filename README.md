# Metabolomics Pipeline
Joel Parker

## Overview

The purpose of this pipeline is to provide additional analyses to
complement the analysis by Metabolon. In the Metabolon data, each
“sub-pathway” classifies a collection of metabolites, and each
“super-pathway” classifies a collection of sub-pathways. The below
figure highlights the steps we will be taking, which highlight the main
modules of this pipeline. The workflow for each module is highlighted in
the [Modules](#modules) section, which will link each step of the
pipeline to the .R files.

<img src="Workflow.png"/>

The figure above highlights the six modules in this pipeline

1.  [Peak Normalization and
    standardization](#peak-normalization-and-standardization)

2.  [Analysis Data Creation](#analysis-data-creation)

3.  [Exploratory Peak Analysis](#exploratory-peak-analysis)

4.  [Subpathway Analysis](#subpathway-analysis)

5.  [Pairwise Comparisons at the metabolite
    level](#pairwise-comparisons-at-the-metabolite-level)

6.  [Metabolite box plots and line plots within
    subpathways](#metabolite-box-plots-and-line-plots-within-subpathways)

Prior to jumping into the details of each of the modules, the README
disscusses [installation](#installation) and [how to get
started](#getting-started) using the pipeline.

## Installation

To download this pipeline, first make sure you have installed devtools.

``` r
# Install Dev tools
install.packages("devtools")
```

Now you can download the pipeline from Git-hub.

``` r
# Download pipeline from Github
devtools::install_github("JoelParkerUofA/Metabolomics-Pipeline")
```

Once the pipeline has finished downloading, you can open the R project
by opening the “Metabolomic Pipeline.Rproj” to run this pipeline on your
local computer.

## Getting Started

#### Demo Data Set

The workflow comes with a dataset in the Data/Metabolon folder which
contains metaboloic profiles across several treatment groups and time
points of ALS in mice. To get started, the vignette folder has a file
called WorkflowVignette.Rmd. This file walks through all steps of the
pipeline using the ALS data.

#### Your Own Data

If you have data from Metabolon, you can simply place the .xlsx file
from Metabolon in the “Data/Metabolon” folder and run the
“Analysis_data_creation.Rmd” .Rmd file in the “Code” folder to create
the analysis data. Once the analysis data is created, you can run any of
the analysis sections in the “Code” folder independently.

### renv

This pipeline utilizes the
[renv](https://rstudio.github.io/renv/articles/renv.html#reproducibility)
package to ensure the R environment is consistent for each run. This
means that all of the required packages for this project will be
automatically installed within the Metabolomics Pipeline project folder.
If you are using this pipeline for the first time, then use
renv::restore() prior to running any of the files. This will install and
update package versions used to generate this pipeline. It should be
noted, this pipeline was generated using R 4.3.1 so if you are using an
older version of R, then it is possible package versions may not be able
to be reinstalled due to dependency issues. If this is the case we
recommend to update your R version to R 4.3.1 or greater.

### Folder Structure within git-hub

To get started, in the Metabolomics pipeline working directory, there
are five folders with the following folder structure:

-   Data
    -   Metabolon: Contains the .xlsx file from Metabolon and other
        files related to the metadata.
    -   Processed: Contains data processed from this pipeline.
-   Code: Contains the .R files of each step of the pipeline.
-   Outputs
    -   Plots
    -   Tables
    -   Reports
-   R: Contains and .R file with additional functions used for this
    pipeline.
-   renv: This folder is generated by renv to restore package versions.

You should save the .xlsx file from Metabolon and any additional
metadata files to the Data/Metabolon folder. The main output folder will
contain the plots and tables generated from this pipeline. Additionally,
you can run this pipeline as a report and save it as a .pdf or .html.
The report saves to the “Outputs/Reports” folder.

## Modules

### Peak Normalization and standardization

Since Metabolome provides peak normalization and standardization, we
recommend using the normalized peak data from Metabolome rather than
“re-normalizing” the peak data. However,

<img src="README_files/figure-markdown_github/mermaid-figure-1.png"
style="width:8in;height:11.47in" />

### Analysis Data Creation

<img src="README_files/figure-markdown_github/mermaid-figure-11.png"
style="width:10.31in;height:22.28in" />

### Exploratory Peak Analysis

#### PCA

<img src="README_files/figure-markdown_github/mermaid-figure-10.png"
style="width:6.29in;height:6.85in" />

#### Heatmaps

<img src="README_files/figure-markdown_github/mermaid-figure-9.png"
style="width:7.57in;height:11.82in" />

#### Statified Heatmaps

<img src="README_files/figure-markdown_github/mermaid-figure-8.png"
style="width:9.09in;height:12.28in" />

### Subpathway Analysis

#### Subpathway analysis

<img src="README_files/figure-markdown_github/mermaid-figure-7.png"
style="width:11.67in;height:15.69in" />

#### Subpathway results tables

<img src="README_files/figure-markdown_github/mermaid-figure-6.png"
style="width:13.07in;height:5.01in" />

### Pairwise Comparisons at the metabolite level

#### 1. Pairwise Analysis

<img src="README_files/figure-markdown_github/mermaid-figure-5.png"
style="width:9.5in;height:4.94in" />

#### 2. Pairwise Results Strata Visualizations

<img src="README_files/figure-markdown_github/mermaid-figure-4.png"
style="width:4.86in;height:4.79in" />

### Metabolite box plots and line plots within subpathways.

#### Box Plots

<img src="README_files/figure-markdown_github/mermaid-figure-3.png"
style="width:9.63in;height:7.91in" />

#### Line Plots

<img src="README_files/figure-markdown_github/mermaid-figure-2.png"
style="width:9.94in;height:9.57in" />
